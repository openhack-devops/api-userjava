name: Deploy

on:
  workflow_run:
    workflows: ["build"]
    types:
      - completed

jobs:
  deploy:

    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - uses: azure/login@v1
          with:
            creds: ${{secrets.AZURE_CREDENTIALS}}
      - name: Deploy the ACR Image to App Service
        env:
          ACR_REGISTRY: openhackagraj1acr.azurecr.io
          ACR_REPOSITORY: devopsoh/api-user-java
          APP_NAME: devops-api-user-java
        uses: azure/webapps-deploy@v2
        with:
          app-name: $APP_NAME
          publish-profile: ${{ secrets.azureWebAppPublishProfile }}
          images: $ACR_REGISTRY/$ACR_REPOSITORY:latest
